---
title: "Linear Regression"
format: pdf
editor: visual
---

## Module 3 - Activity 4

Of the models with a convex representation of their parametricestimation, generalized linear models (GLM) are a crucial case.The two most frequent examples of GLM are linear regression andlogistic regression. Therefore, in this activity, several linear regressionand logistic regression exercises will be solved with R software andsome of its packages.

#### Activities Problem 1: Warm Up

##### 1. Section 3.7 Problem 8.

This question involves the use of simple linear regression on the Auto data set.

##### a) Use the lm() function to perform a simple linear regression with mpg as the response and horsepower as the predictor. Use the summary() function to print the results. Comment on the output.

Adding the necessary libraries

```{r}
#| warning: false
library(ISLR2)
library(tidymodels)
library(dplyr)
library(modelsummary)
```

Loading dataframe

```{r}
auto <- Auto
head(auto)
```

The Auto df counts with 9 columns that show information of different models of vehicles. For the present exercise is intended to evaluate if exists any relationship

```{r}
linearmodelauto <- lm(mpg ~ horsepower, data = auto)
linearmodelauto
```

-   Is there a relationship between the predictor and the response?

    Yes there is a relationship between the variables

```{r}
summary(linearmodelauto)
```

-   How strong is the relationship between the predictor and the response

    With the p values of the model (\<0.0001) we can assume that the model is significant to explain the relationship between our variables . Also the $R^{2}$ of 60% indicates that there is a highly correlation between this variables

-   Is the relationship between the predictor and the response positive or negative?

    The relationship is negative

-   What is the predicted mpg associated with a horsepower of 98? What are the associated 95 % confidence and prediction intervals?

```{r}
predict(linearmodelauto, tibble(horsepower=98), interval = "confidence")
```

##### 

b)  Plot the response and the predictor. Use the abline() functionto display the least squares regression line.

```{r}
auto %>%
  ggplot(aes(x = horsepower)) +
  geom_point(aes(y = mpg), size = 2, alpha = 0.4) +
  geom_abline(slope = coef(linearmodelauto)["horsepower"],
              intercept = coef(linearmodelauto)["(Intercept)"],
              size = 2, color = "blue")
```

##### c) Use the plot() function to produce diagnostic plots of the least squares regression fit. Comment on any problems you see with the fit.

```{r fig.width=10,fig.height=11}
linearmodelauto %>% performance::check_model()
```

#####  1. Section 3.7 Problem 9.

This question involves the use of simple linear regression on the Auto data set.

#### a)Produce a scatter-plot matrix which includes all of the variables in the data set.

```{r fig.width=14,fig.height=12}
#| warning: false
p <- GGally::ggpairs(auto %>% select(-name))
print(p,progress=F)
```

#### b)Compute the matrix of correlations between the variables using the function cor(). You will need to exclude the name variable, cor()which is qualitative.

```{r}
cor(auto %>% select(-name))
```

#### c)Use thelm() function to perform a multiple linear regression with mpgas the response and all other variables except name ast he predictors. Use thesummary() function to print the results.Comment on the output. For instance:

```{r}
multiplelinearmodel <- recipe(mpg ~ ., data = auto) %>% step_rm(name)

mlrworkflow <- workflow() %>% add_recipe(multiplelinearmodel) %>% add_model(linear_reg())

mlrworkflow
```

```{r}
mlrfit <- mlrworkflow %>% fit(data = auto)
mlrfitengine <- extract_fit_engine(mlrfit)
summary(mlrfitengine)

```

1.  Is there a relationship between the predictors and the response?

    There is a relationship between the predictors and the response ($p<0.001$) therefore the model can explain the relationship. Also the $R^2$ is \> 80% explaining a lot of variance with this model

2.  Which predictors appear to have a statistically significant relationship to the response?

    Displacement, Weight, Year, Origin

3.  What does the coefficient for the $year$ variable suggest?

    The relationship between the mpg and the year is positive recent years make that the miles per gallon performance increase

#### d)Use theplot()function to produce diagnostic plots of the linearregression fit. Comment on any problems you see with the fit.Do the residual plots suggest any unusually large outliers? Doesthe leverage plot identify any observations with unusually high leverage?

```{r fig.width=10,fig.height=11}
mlrfit %>% extract_fit_engine() %>% performance::check_model()


```

#### e)Use the $*$ and **:** symbols to fit linear regression models with interaction effects. Do any interactions appear to be statistically significant?

```{r}
#| echo: false
vintmodel<- as.formula(                      # Create formula
  paste("mpg ~ ", paste(colnames(auto)[c(2,3,4,5,6,7,8)], collapse = " * ")))                                  # Print formula
```

```{r}
#| warning: false
multiplelinearmodelint <- lm(mpg ~ cylinders * displacement , data = auto)

summary(multiplelinearmodelint)
```

#### f)Try a few different transformations of the variables, such aslog(X),√X,X2. Comment on your findings.
